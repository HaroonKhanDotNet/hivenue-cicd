**Note:** This is a Requirement Gathering Meeting Document between Hivenue and BTC6 and still a Work in Progress (WiP).

#
# Hivenue CI/CD Pipeline
**[Riipen Pages - https://beyondthecloud.riipen.com/teams/QVdXDavV](https://beyondthecloud.riipen.com/teams/QVdXDavV)**
___
`Project Kick-off` 2024 Oct 15 Tue

`Meeting One Held On` 2024 Oct 18 Fri | `Day#04`

| Hivenue                       | BTC6                  |
|-------------------------------|-----------------------|
| Nassim Bahloul `CEO`          | Alejandro Castellanos |
| Louenas Hamdi `CTO`           | Jayme Liao            |
| Hanson Liang `Lead Developer` | Haroon Khan           |

## Requirement:
Hivenue need to integrate ***Development Environment*** with a ***CI/CD Pipeline*** to *automate* production deployment.

![Hivenue CI/CD Pipeline](hivenue_cicd.svg)

For more information: [BRD](BRD.md)

### Hivenue Workflow (Current)

1. `Github Organization` Hivenue codebase is `private` on Github.
2. `Build` Hivenue do Not build code on Github
3. `Unit Test` Hivenue use `Jest` framework to unit/integration test on
    - Local development environment
    - Github Action
4. `Commit` Hivenue commit code on Github branch only after passing the local unit/integration test
    - `back-end` containing Express/MongoDB codebase
    - `front-end` containing Angular codebase
5. `TestOps` Hivenue manually Code and Test and Commit the codebase
6. `DigitalOcean` Hivenue staging and deployment platform is `Ubuntu Server 24.04` with
    - `Nginx` Web Server for `Angular` framework
    - `NodeJS` Application Server for `Express` framework
    - `MongoDB` DB Server for AI model, Hivenue Platform, Billing and Admin modules
7. `Staging` Hivenue has 'one' staging server running all three runtimes `Nginx`, `Nodejs` and `MongoDB`
    - Hivenue manually run `bash script` to download Github Codebase and Dependencies and Build Package to deploy on single stage server with respected runtimes
8. `End-to-End Test` Hivenue manually test all functions to pass on staging server
6. `Production` Hivenue has 'three' deployment servers running: Nginx/Angular, Nodejs/Express and MongoDB separately 
    - Hivenue manually run `bash script` on each server to download and deploy each codebase type from `Stage` to `Prod` servers respectively

### Hivenue Workflow (Requirement)

1. `Github Organization` Hivenue codebase is `private` on Github
2. `Unit Test` Hivenue use `Jest/Jasmine` framework to unit/integration test on local development environment
3. `Commit` Hivenue commit code on Github branch only after passing the local unit/integration test
    - `back-end` containing Express/MongoDB codebase
        - `ai model` containing ai trained model codebase
        - `platform` containing hivenue platform codebase
        - `billing` containing hivenue billing codebase
        - `admin` containing hivenue admin codebase
    - `front-end` containing hivenue angular codebase
4. `Automate TestOps` Hivenue Github Workflow automatically get triggered on
    - `commit` code event
    - `build` by getting the codebase and downloading its dependencies and transpile
    - `test` by running Jasmine/Jest unit/integration test to pass or fail the build
    - `push notification` send to all points of contact on success/fail of build
5. `DigitalOcean` Hivenue staging and deployment platform is `Ubuntu Server 24.04` with
    - `Nginx` Web Server for `Angular` framework
    - `NodeJS` Application Server for `Express` framework
    - `MongoDB` DB Server for AI model, Hivenue Platform, Billing and Admin modules
    - `staging` to deploy codebase on staging using an `access token` or `access/secret key` role credential generated by DigitalOcean IdP
6. `E2E test` after stage deployment, Github action can trigger Playwright/Cypress end-to-end test scripts
    - `push notification` github action can push delivery fail/success to designated points of contact
8. `Production` Hivenue has 'three' deployment servers running: Nginx/Angular, Nodejs/Express and MongoDB separately 
    - `approval` hivenue could manually approve to deploy codebase from github to production servers
    - `automatic deployment` codebase could be deployed automatically from github to production
 

### BTC6 Workflow Requirements

#### Phase-1
1. `Github Access` Hivenue will add BTC6 to their `Github Organization`
2. `Riipen Branch` Hivenue will create a new branch parallel to their `main`
3. `Riipen Commit` Hivenue will commit on `riipen branch` in parallel to every `main branch` commit.
4. `Riipen Event` BTC6 should be able to receive the `event on push` upon every code commit to `riipen branch`.
5. `Github Workflow` Code commit to `riipen branch` will trigger the workflow to automatically:
    - build
    - test (unit/integration) the codebase in Jasmine/Jest
    - issue `push notification` (build pass/fail) to points of contact

#### Phase-2
1. `Riipen Staging` Hivenue will spin-up a clone staging server on DigitalOcean for BTC6 End-to-End testing platform
2. `Riipen Role` Hivenue will create at least one role on DigitalOcean to deploy to staging from GitHub 
3. `Github Workflow`
    - `Stage Deployment` Hivenue will provide permission to GitHub Action to deploy the code package to DigitalOcean Stage Server using role
    - `Playwright/Cypress E2E Testing` Hivenue will provide permission to run E2E Test Scripts on GitHub Action
    - `push notification` (delivery pass/fail) to points of contact

#### Phase-3
1. `Riipen Production` Hivenue will spin-up clone production servers
2. `Blue-Green/Canary Deployment` Hivenue will provide configuration or access to DigitalOcean to a suitable deployment strategy
    - Traffic can be diverted slowly and gradually to the new poduction servers (blue) in order to test them live
    - green (old production) can be phased out once all traffic is diverted successfully over a certian period without any CI/CD issue
3. `monitor` Hivenue and BTC6 will monitor the performance parameters to record in the final report
